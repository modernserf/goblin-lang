import [_Assert_ _Array_ _Cell_ _Vec_ _Option_ _HashMap_ _BitSet_] := "core"

# cell
let a := Cell{: 0}
let b := a
a{: 1}

Assert{
  received: b{}
  expected: 1
}

# arrays
let xs := Array{}
xs{push: 1}{push: 2}{push: 3}

Assert{
  received: xs{at: 1}
  expected: 2
}

xs{at: 1 value: 6}
Assert{
  received: xs{at: 1}
  expected: 6
}
Assert{
  received: xs{pop}
  expected: 3
}
Assert{
  received: xs{length}
  expected: 2
}
let ys := xs{copy}
xs{pop}
Assert{
  received: xs{length} + 1
  expected: ys{length}
}

let base := Array{}, 1, 2, 3
let slice := base{from: 1 to: 3}
Assert{received: slice{length} expected: 2}
Assert{received: slice{at: 0} expected: 2}

var bs := BitSet{}
set bs{add: 1}
set bs{add: 30}
set bs{add: 58}
Assert{:bs{has: 1}}
Assert{:bs{has: 30}}
Assert{:bs{has: 58}}
Assert{false: bs{has: 20}}
Assert{false: bs{has: 63}}

let cs := (Vec{}, 4, 30, 22){into: BitSet{} fold: [add]}
Assert{:cs{has: 4}}
Assert{:cs{has: 30}}
Assert{:cs{has: 22}}

let intersect := bs & cs
Assert{: intersect{has: 30}}
Assert{false: intersect{has: 1}}
Assert{false: intersect{has: 4}}

Assert{
  expected: bs{to Vec}
  received: Vec{}, 1, 30, 58
}
